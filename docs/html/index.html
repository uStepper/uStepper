<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>uStepper: Arduino library for the uStepper Board</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">uStepper
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Arduino library for the <a class="el" href="classuStepper.html" title="Prototype of class for accessing all features of the uStepper in a single object. ...">uStepper</a> Board </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is the <a class="el" href="classuStepper.html" title="Prototype of class for accessing all features of the uStepper in a single object. ...">uStepper</a> Arduino library, providing software functions for the different features of the <a class="el" href="classuStepper.html" title="Prototype of class for accessing all features of the uStepper in a single object. ...">uStepper</a> board.</p>
<dl class="section user"><dt>News!</dt><dd>This version of the library adds a new functions to the library: MoveToEnd() - This function makes the motor turn in the specified direction, until an obstacle is detected, at which point the motor stops and resets its home position Changed the "LimitDetection" example to make use of the new moveToEnd() function</dd></dl>
<p>Also some adjustments have been made to different functions. See changelog</p>
<dl class="section user"><dt>Features</dt><dd>The <a class="el" href="classuStepper.html" title="Prototype of class for accessing all features of the uStepper in a single object. ...">uStepper</a> library contains the following features:</dd></dl>
<ul>
<li>Second order acceleration profile, to provide smooth ramping of the speed and to avoid the motor stalling when demanding high speeds.</li>
<li>Closed loop PID position controller</li>
<li>Control of RC servo motors</li>
<li>Temperature measurement of the stepper driver chip by means of a NTC resistor placed beneath the chip.</li>
<li>Measure the current position of the shaft (absolute, multiple revolutions)</li>
<li>Measure the current speed of the motor</li>
</ul>
<p>The library uses both timer one and timer two in order to function properly, meaning that unless the user of this library can accept the loss of some functionality, these two timers are unavailable and the registers associated with these timers should not be reconfigured.</p>
<p>Timer one is used for sampling the encoder in order to provide the ability to keep track of both the current speed and the angle moved since the board was reset (or a new home position was configured). Also the drop-in features missed step detection and correction is done in this timer.</p>
<p>Timer two is used to calculate the stepper acceleration algorithm. </p><dl class="section warning"><dt>Warning</dt><dd>In order to get some features working, it was necessary to write functions to control the I2C hardware in the MCU, since the build in wire library of Arduino uses interrupt which doesn't play well when used inside a timer interrupt routine. Therefore if the user of this library needs to use the I2C bus, the user should use the functions defined in this library instead of wire library !</dd></dl>
<dl class="section user"><dt>Installation</dt><dd>To install the <a class="el" href="classuStepper.html" title="Prototype of class for accessing all features of the uStepper in a single object. ...">uStepper</a> library into the Arduino IDE, perform the following steps:</dd></dl>
<ul>
<li>Go to Sketch-&gt;Include Libraries-&gt;Manage Libraries... in the arduino IDE</li>
<li>Search for "uStepper", in the top right corner of the "Library Manager" window</li>
<li>Install <a class="el" href="classuStepper.html" title="Prototype of class for accessing all features of the uStepper in a single object. ...">uStepper</a> library</li>
</ul>
<p>The library is tested with Arduino IDE 1.8.5</p>
<dl class="section warning"><dt>Warning</dt><dd>MAC users should be aware, that OSX does NOT include FTDI VCP drivers, needed to upload sketches to the <a class="el" href="classuStepper.html" title="Prototype of class for accessing all features of the uStepper in a single object. ...">uStepper</a>, by default. This driver should be downloaded and installed from FTDI's website: </dd>
<dd>
<a href="http://www.ftdichip.com/Drivers/VCP.htm">http://www.ftdichip.com/Drivers/VCP.htm</a> </dd>
<dd>
The <a class="el" href="classuStepper.html" title="Prototype of class for accessing all features of the uStepper in a single object. ...">uStepper</a> should NOT be connected to the USB port while installing this driver ! </dd>
<dd>
This is not a problem for windows/linux users, as these drivers come with the arduino installation.</dd></dl>
<dl class="section user"><dt>Theory</dt><dd></dd></dl>
<p>The acceleration profile implemented in this library is a second order profile, meaning that the stepper will accelerate with a constant acceleration, the velocity will follow a linear function and the position will look like an S-curve (it will follow a linear function at top speed and a second order function during acceleration and deceleration). As a result, the position of the stepper motor will have continous and differentiable first and second derivatives.</p>
<p>The second order acceleration profile can be illustrated as follows (<a href="http://picprog.strongedge.net/step_prof/step-profile.html" rel="license">Source</a>):</p>
<div class="image">
<img src="dva.gif" alt="dva.gif"/>
</div>
<p>From the above picture it can be seen how the motor moves with this second order acceleration profile. The postion is depicted as orange, velocity as red and the acceleration as green.</p>
<p>The algorithm used is NOT designed by me, I ONLY implemented the algorithm! credit is therefore given to the appropriate author: Aryeh Eiderman.</p>
<p>for those interested, the deriviation of the algorithm used can be found at the following webpage (Which is neither owned nor affiliated with ON Development IVS in any way): <a href="http://hwml.com/LeibRamp.pdf" rel="license">Real Time Stepper Motor Linear Ramping Just by Addition and Multiplication</a></p>
<dl class="section user"><dt>Copyright</dt><dd></dd></dl>
<p>(C)2016 ON Development IVS</p>
<p>www.on-development.com</p>
<p><a href="#" onclick="location.href='mai'+'lto:'+'adm'+'in'+'ist'+'ra'+'tio'+'n@'+'on-'+'de'+'vel'+'op'+'men'+'t.'+'com'; return false;">admin<span style="display: none;">.nosp@m.</span>istr<span style="display: none;">.nosp@m.</span>ation<span style="display: none;">.nosp@m.</span>@on-<span style="display: none;">.nosp@m.</span>devel<span style="display: none;">.nosp@m.</span>opme<span style="display: none;">.nosp@m.</span>nt.co<span style="display: none;">.nosp@m.</span>m</a></p>
<div class="image">
<img src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" alt="Creative Commons License" style="border-width:0"/>
</div>
<p>The code contained in this file is released under a <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="license">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a></p>
<p>The code in this library is provided without warranty of any kind - use at own risk! neither ON Development IVS nor the author, can be held responsible for any damage caused by the use of the code contained in this library !</p>
<dl class="section user"><dt>To do list</dt><dd><ul>
<li>Clean out in unused variables</li>
<li>Update comments</li>
<li>Add support for limit switches</li>
<li>Split the library into multiple files</li>
</ul>
</dd></dl>
<dl class="section user"><dt>Known Bugs</dt><dd><ul>
<li>No known bugs</li>
</ul>
</dd></dl>
<dl class="section author"><dt>Author</dt><dd>Thomas HÃ¸rring Olsen (<a href="#" onclick="location.href='mai'+'lto:'+'tho'+'ma'+'s@u'+'st'+'epp'+'er'+'.co'+'m'; return false;">thoma<span style="display: none;">.nosp@m.</span>s@us<span style="display: none;">.nosp@m.</span>teppe<span style="display: none;">.nosp@m.</span>r.co<span style="display: none;">.nosp@m.</span>m</a>) </dd></dl>
<dl class="section user"><dt>Change Log</dt><dd></dd></dl>
<dl class="section version"><dt>Version</dt><dd>1.3.0:<ul>
<li>Changed MoveToAngle() function, to support update of angle setpoint in PID mode</li>
<li>Changed getMotorState() function, to support update of angle setpoint in PID mode</li>
<li>Fixed bug in moveAngle() function, where negative inputs had no effect</li>
<li>Changed the "LimitDetection" example to make use of the new moveToEnd() function </li>
</ul>
</dd>
<dd>
1.2.3:<ul>
<li>Added moveAngle() and MoveToAngle() functions</li>
<li>Minor adjustments in setup routines </li>
</ul>
</dd>
<dd>
1.2.2:<ul>
<li>Adjusted parameters in limitDetection example, and dropin example</li>
<li>Added setCurrent() function to the <a class="el" href="classuStepper.html" title="Prototype of class for accessing all features of the uStepper in a single object. ...">uStepper</a> object, for the user to easily change current setting</li>
<li>Minor corrections in PID algorithms </li>
</ul>
</dd>
<dd>
1.2.1:<ul>
<li>Fixed a bug in the implementation of the standalone PID controller, primarily anti windup</li>
<li>Added example to show how limit detection can be implemented without the use of limit switches</li>
<li>Adjusted encoder.setHome() function to also reset the stepsSinceReset variable </li>
</ul>
</dd>
<dd>
1.2.0:<ul>
<li>Adjusted the code related to the PID closed loop position control. Now it actually works as intended!</li>
<li>Fixed Bug with encoder.getStrength and encoder.getAgc functions not reading the correct registers in the encoder</li>
<li>Changed getStepsSinceReset() to return a 32 bit signed integer, instead of a 64 bit signed integer, which is just overkill, and doesn't really play well with arduino</li>
<li>Changed some minor things in the assembly code to optimise stuff with regards to the PID mode</li>
<li>Fixed a bug in the assembly code causing the StepsSinceReset variable to always decrease regardless of the direction of rotation. This resulted in the number of steps moved since reset, always being negative</li>
<li>Fixed a typo in the documentation of the getCurrentDirection() function, to state the correct return values</li>
<li>Added several keywords to the library</li>
<li>Added Example to demonstrate the use of PID closed loop position control </li>
</ul>
</dd>
<dd>
1.1.0:<ul>
<li>Fixed bug with encoder.setHome() function, where number of revolutions was never reset, resulting in the angle being reset to the number of revolutions times 360 degrees, instead of 0 degrees</li>
<li>Implemented Timeout in I2C functions. This ensures that the program will not lock up if access to a non-existing I2C address is attempted.</li>
<li>Added overloaded function to pwmD8() and pwmD3(), in order to be able to revert the function of these to pins, back to normal IO mode </li>
</ul>
</dd>
<dd>
1.0.0:<ul>
<li>Added PID functionality to drop-in Feature</li>
<li>Added PID functionality to regular movement functions</li>
<li>Added support for servo motors</li>
<li>Added two new examples </li>
</ul>
</dd>
<dd>
0.4.5:<ul>
<li>Changed setup of Timer1 and Timer2, to allow for PWM generation on D3 and D8. See documentation of "pwmD3()" and "pwmD8()" functions in class "uStepper", for instructions.</li>
<li>Changed setup of external interrupts for dropin feature, to be able to compile with arduino IDE 1.6.10.</li>
<li>Updated board installation package to version 1.1.0, to be compliant with arduino IDE 1.6.10. Update <a class="el" href="classuStepper.html" title="Prototype of class for accessing all features of the uStepper in a single object. ...">uStepper</a> board using package manager in Arduino IDE ("Tools-&gt;Board-&gt;Board Manager", scroll down to the <a class="el" href="classuStepper.html" title="Prototype of class for accessing all features of the uStepper in a single object. ...">uStepper</a> board and choose update or install). </li>
</ul>
</dd>
<dd>
0.4.4:<ul>
<li>Added the attribute "used" to declarations of interrupt routines. This enables the library to be compiled in Arduino IDE 1.6.10</li>
<li>Updated documentation of "uStepper::setup()" </li>
</ul>
</dd>
<dd>
0.4.3:<ul>
<li>Fixed bug where initial deceleration phase (used when changing speed setting or changing direction while motor is moving), would never be entered, causing motor to accelerate </li>
</ul>
</dd>
<dd>
0.4.2:<ul>
<li>Fixed bug with setHome() causing getAngleMoved() to return alternating values (offset by exactly 180 degrees) between resets.</li>
<li>Fixed bug in runContinous(), where direction of the motor did not get updated if the function was called with the motor standing still. </li>
</ul>
</dd>
<dd>
0.4.1:<ul>
<li>Fixed bug with getAngleMoved() returning alternating values (offset by exactly 180 degrees) between resets.</li>
<li>Added keywords</li>
<li>Updated pin connection description for Drop-in example </li>
</ul>
</dd>
<dd>
0.4.0:<ul>
<li>Added Drop-in feature to replace stepsticks with <a class="el" href="classuStepper.html" title="Prototype of class for accessing all features of the uStepper in a single object. ...">uStepper</a> for error correction</li>
<li>Fixed bug in stepper acceleration algorithm, making the motor spin extremely slow at certain accelerations. Also this fix reduced the motor resonance</li>
<li>Implemented an IIR filter on the speed measurement, to smooth this out a bit. </li>
</ul>
</dd>
<dd>
0.3.0:<ul>
<li>Added support for speed readout</li>
<li>Added support for measuring the shaft position with respect to a zero reference. (absolute within multiple revolutions) </li>
</ul>
</dd>
<dd>
0.2.0:<ul>
<li>Complete rewrite of the stepper algorithm in assembler</li>
<li>Changed from fixed point to floating point variables, due to the need for more precision</li>
<li>Removed the getSpeed() method, as it didn't work, and therefore it would make more sense to remove it and re-add it when i get the time to fix it</li>
<li>Added a few doxygen comments</li>
<li>Added a new method (getStepsSinceReset()), which returns all steps performed since reset of the <a class="el" href="classuStepper.html" title="Prototype of class for accessing all features of the uStepper in a single object. ...">uStepper</a>. positive values corresponds to steps in clockwise direction, while negative values corresponds to steps in counterclockwise direction. </li>
</ul>
</dd>
<dd>
0.1.0:<ul>
<li>Initial release </li>
</ul>
</dd></dl>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jan 10 2018 20:22:00 for uStepper by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
